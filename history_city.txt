30.09.2024
Вер. 1.3.4
[+]
В модель C:\xampp\htdocs\city\application\classes\artonitHTTP.php добавлено чтение состояния SCUD.

Добавлена колонка 11, в которой указан режим работы контроллера и номер ридера: d1-одна дверь на два считывателя, d2 - две независимые двери. 
d1 0 - одна дверь на два считывателя, ридер 0.
d1 1 - одна дверь на два считывателя, ридер 1. ВНИМАНИЕ! при этой комбинации точка прохода 2 должна быть выключена! Отключение происходит на веб-панели контроллера.
d2 0 - две двери, ридер 0
d2 1 - две двери, ридер 1.

Добавлены пояснения к знаку "Внимание": подсказывается что надо делать.


[-]
[*]
В контроллере Dashboard в методе action_device_control checkStatus процедура fixKeyOnDbCountForDoors заменена на fixKeyOnCardidx. Теперь количество карт по базе данных в колонке 9 показывается правильно. Раньше при обновлении данных через кнопку "Записать текущее состояние в БД" выводиласт цифра с учетом срока действия карт, что приводило к искажению информации. Теперь цифры выводятся правильные.

14.09.2024
Вер 1.3.3
[+]
Добавлен общий индикатор "Внимание!!!" (крайний правый ряд колонки). Иконка отображается, если в строке хотя бы один элемент требует внимания.

В каждой строке реализован анализ параметра и выводится иконка "Внимание" для привлечения внимания.

Реализована сортировка по колонкам 50, 51, 52, 11, 12, 13.

Добавлен выбор список контроллеров при старте сбора информации collectStatFromDevice.php. Теперь выбор производится из всех транспортных серверов с типом 1 (обслуживание Артонит). В то же время можно указать номер Транспортного сервера, по которому надо работать.

Для сбора информации по системе необходимо запустить файл \xampp\htdocs\city\stat_09_2023_task.bat. Скрипт сам выберет нужные контроллеры и проведет опрос.
В файл конфигурации artonitcity_config.php добавлен параметр 'baseFormatRfid'=>'0', //0 - HEX 8 byte 00124CD8, 1 -  001A 10 byte 262F8F001A. 

При опросе контроллеров серии Артонит время ожидания ответа настраивается в файле \xampp\htdocs\city\application\classes\artonitHTTP.php:
curl_setopt($this->ch, CURLOPT_CONNECTTIMEOUT, 5);
Ответ от контроллера ожидается в течении 5 секунд. Если ответ не получен в течении указанного времени, то начинается опрос следующего контроллера.
В сильно загруженных сетях возможно увеличение времени до 60 секунд.
Большое время ожидания ответа увеличивает время работы скрипта при большом количестве контроллеров не на связи.

При сохранении файла состояния системы в название файла добавлено название объекта.

На панель Центр - Информация по сотрудникам добавлен индикатор "Неправильный формат RFID". Правильное состояние - 0. Если не 0, то сверка карт работать не будет.

[*]
Устранена ошибка [internal function]: Kohana_Core::error_handler(2, 'implode() [<a h...', 'C:\xampp\htdocs...', 677, Array) при сохранении файла состояния. Причина: нет информации о количестве карт. Теперь выполняется проверка данных (массив ли?) и исходя из этого формируется запись в файле.
 
Изменен поиск по номеру карты: добавлен выбор формата ввода номера для поиска. Это позволяет избежать путаницы между 123456HEX и 123456DEC.

Добавлен анализ текста версии контроллера. Если он состоит из UTF, то делается попытка преобразовать его в win1251 для правильного сохранение в базе данных. Раньше была ошибка, в результате чего название терялось полностью.

13.09.2024
Версия 1.3.2
[+]
Контроллеры - добавлена кнопка "Сохранить в файл". При ее нажатии информация о состоянии контроллеров сохраняется в файл в формате csv.
[*]
Внесено много мелких исправлений в форму Контроллеры.
[-]
Todo

1.09.2024

Версия 1.3.1
[+]
В класс phpArtonitTS2.php добавлена диагностика при отказе в подключении: нет подключения к транспортному серверу, или нет контроллера в транспортном сервере.
[*]
Выявлена и устранена ошибка: при показе количества карт по базе данных вместо архивных данных (из st_data) брались текущие значения по точке прохода. Это приводило к ошибке в показаниях на странице. Исправлено.
Расчет разницы карт так же выполняется неверено. Исправлено.

1.09.2024
Версия 1.3
[+]
Добавлены классы:
DeviceInfo 
phpArtonitTS2
phpArtonitUDP
TS2client
artonitHTTP
в таблицу st_data добавлены 
INSERT INTO ST_PARAM (ID_PARAM,NAME) VALUES (113,'deviceInfo');

В ходе сбора информации по контроллерам данные в формате json вставляется  в таблицу st_data как параметр 113.
Теперь в таблице st_data используются только параметры 8 и 113.
[*]
Изменен порядок сбора данных от контроллеров. Сбор данных производится в задаче collectStatFromDevice. Для запуска сбора полного пакета информации надо запускать \xampp\htdocs\city\stat_09_2023_task.bat
Изменена экранная форма закладки Контроллеры. Добавлены:
состояние online в явном виде,
состояние перемычки WP
состояние перемычки Test
в название контроллера добавлен его IP адрес. Теперь можно быстро перейти на веб-панель контроллера. IP адрес контроллеров надо вводить вручную (клик по названию контроллера – форма для редактирования).
Версия контроллера СКУД показывает емкость контроллера,
Количество карт в базе данных. ВНИМАНИЕ! Подсчет карт ведется  по таблице cardidx, т.е. без учета срока действия карты.
Количество карт в точке прохода (в контроллере).
Различия в количестве карт выведены отдельной колонкой.
Состояние входа isBlocked точки прохода,
Состояние входа  isAlarm точки прохода,
Time – время сбора информации по точке прохода. В дальнейшем этот показатель будет отключен,
Expired – показатель, когда "снимались" данные о состоянии контроллера.
Исправлены ошибка при поиске по номеру карты. 
[-]
[Todo]
1.09.2024
В свойствах контроллера необходимо добавить возможность указывать его тип. Особенно остро это будет при добавлении устройства bas-ip.
Надо рассмотреть возможность использовать Контроллеры как элемент конфигурирования СКУД: добавление/удаление/изменение контроллеров и точек прохода.
При сравнении номеров карт их номер может быть 8 байт (для формата HEX) и 10 байт (для формата 001A). Очевидно, что при сравнении карт необходимо исключить ситуацию, когда формат хранения 10 байт, а сравнение происходит по 8 байт. Надо или отменить выравнивание до нужного количества байт, либо тщательно следить за отсутсвием ошибок в базе данных.
2.09.2024
Перед сверкой необходимо выполнять проверку формата карт. Это можно делать с помощью Model::factory('dbskud')->checkRfidKeyFormat(). Если ноль – то выполнять сверку. Если НЕ ноль, то выводить список неправильных карт. 

3.09.2024
В \\26.80.107.178\xampp\htdocs\city\application\classes\Model\Device.php -> sendCommand надо переделать процесс реализации команд. Надо перейти на классы, и учитывать тип контроллера (не только Артонит, но и bas-ip).

Добавить https://htmlbook.ru/html/acronym?ysclid=m0lzyoalzf875263982